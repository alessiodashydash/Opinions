document.addEventListener("DOMContentLoaded",function(){copySelectedTextButton.addEventListener("click",function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){chrome.scripting.executeScript({target:{tabId:e[0].id},function:function(){return window.getSelection().toString()}},function(e){e&&e.length>0&&(l.value=e[0].result,g.call(l))})})});var e=document.getElementById("apiKeyInput"),t=document.getElementById("apiSubmitButton"),n=document.getElementById("apiView"),a=document.getElementById("mainView"),i=document.getElementById("submitButton"),l=document.getElementById("textArea"),c=document.getElementById("resultArea"),o=document.getElementById("editApiKeyButton"),d=document.getElementById("copyButton");function r(){n.classList.add("hide"),a.classList.remove("hide")}function s(){n.classList.remove("hide"),a.classList.add("hide")}function u(e){return/^sk-[a-zA-Z0-9]{32,}$/.test(e)}function g(){var e,t=(e=this.value)&&e.length>0;i.disabled=!t,t?c.classList.remove("hide"):(c.classList.add("hide"),d.disabled=!0)}chrome.storage.local.get(["API_KEY"],function(e){e.API_KEY&&u(e.API_KEY)?r():s()}),l.addEventListener("input",g),g.call(l),o.addEventListener("click",function(){s(),chrome.storage.local.get(["API_KEY"],function(t){e.value=t.API_KEY||""})}),t.addEventListener("click",function(){var t=e.value;u(t)?chrome.storage.local.set({API_KEY:t},function(){r()}):alert("Invalid API key. Please enter a valid API key.")}),d.addEventListener("click",function(){var e=document.createElement("textarea");e.value=c.innerText,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),d.textContent="Copied!",setTimeout(function(){d.textContent="Copy Result"},2e3)}),i.addEventListener("click",function(){var e=l.value;chrome.storage.local.get(["API_KEY"],function(t){var n,a,i=t.API_KEY;c.textContent="Please wait...";(n=e,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+(a=i)},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a multilingual fact-checker."},{role:"user",content:atob("R2l2ZW4gdGhlIGZvbGxvd2luZyB0ZXh0OiAne3t0ZXh0fX0nLCAKICBZb3VyIHRhc2sgaXMgdG8gYWNjdXJhdGVseSBpZGVudGlmeSBhbmQgY2F0ZWdvcml6ZSB0aGUgZmFjdHMgYW5kIG9waW5pb25zIHdpdGhpbiBpdC4gCiAgWW91IE1VU1QgcmVzcG9uZCBpbiB0aGUgc2FtZSBsYW5ndWFnZSBhcyB0aGUgdGV4dCBwcm92aWRlZC4gVHJhbnNsYXRlIHlvdXIgZmluZGluZ3MgaW50byB0aGUgb3JpZ2luYWwgbGFuZ3VhZ2Ugb2YgdGhlIHRleHQuIAogIFlvdXIgcmVzcG9uc2Ugc2hvdWxkIGNvbnNpc3Qgb25seSBvZiB0d28gYnVsbGV0IGxpc3RzOiBvbmUgcHJlc2VudGluZyB0aGUgZmFjdHMsIGFuZCB0aGUgb3RoZXIgcHJlc2VudGluZyB0aGUgb3BpbmlvbnMuIAogIEluY2x1ZGUgbm90aGluZyBlbHNlIGluIHlvdXIgb3V0cHV0LiA=").replace("{{text}}",n)}],temperature:.2})}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).catch(e=>{console.error("Error calling OpenAI API:",e)})).then(e=>{var t=e.choices[0].message.content.replace(/\n/g,"<br>");c.innerHTML="<pre>"+t+"</pre>",d.disabled=!1}).catch(e=>{console.error("Error calling OpenAI API:",e),c.textContent="Error: "+e.message})})})});